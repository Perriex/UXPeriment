function word_break(e){return e.slice(0,50)+(e.length>=50?"...":"")}function update_menu(){let e=document.getElementById("bipa-menu-container");e.className="hide";let t=document.getElementById("bipa-menu-list");if(!t)return;for(;t.firstChild;)t.removeChild(t.firstChild);let n=get_event_of_URLs();n.forEach(e=>{let n=document.createElement("li"),r=document.createElement("a");if(r.href=e.address,"img"===e.type){let l=document.createElement("img");l.src=e.value,l.alt="link",l.setAttribute("id","bipa-img-wrapper"),l.loading="lazy",r.appendChild(l)}if("title"===e.type){let i=document.createElement("p");i.innerText=e.value,r.appendChild(i)}n.appendChild(r),t.appendChild(n)})}document.addEventListener("keydown",function(e){if(e.ctrlKey&&("m"===e.key||"ئ"===e.key)){let t=document.querySelector("#bipa-menu-container");t.setAttribute("class","hide")}}),document.addEventListener("keydown",function(e){if(e.ctrlKey&&(","===e.key||"و"===e.key)){let t=document.querySelector("#bipa-menu-container");is_data_available()?t.removeAttribute("class"):console.log("%c BIPA has no record of your flow on this website!","background: #f0a0d0; color: #fb2b4b")}}),document.addEventListener("click",e=>{let t=e.target.closest("a");if(t){let n=t.href.replace(/.*\/\/[^/]*(\/[^?]*).*/,"$1"),r=t.querySelectorAll("img"),l=t.querySelectorAll("h1, h2, h3, h4, h5, h6, p, small, b, strong"),i=get_data(),a=i?.recent_urls.findIndex(e=>e.address===n),c=get_current_date();a>-1?(i.recent_urls[a].count=Number(i.recent_urls[a].count)+1,i.recent_urls[a].date=c):r.length>0?i.recent_urls.push({address:n,type:"img",count:0,value:r[0].src,date:c}):n.length>0&&i.recent_urls.push({address:n,value:word_break(l.length>0?l[0].innerText:t.innerText),type:"title",count:0,date:c}),set_data(i),update_menu()}}),async function e(){fetch(chrome.runtime.getURL("../../html/megamenu.html")).then(e=>e.text()).then(e=>{document.body.insertAdjacentHTML("beforeend",e),update_menu()}).catch(e=>console.log(e))}();const get_event_of_URLs=()=>{let e=get_data();return e.recent_urls.reverse().sort((e,t)=>{let n=new Date(t.date)-new Date(e.date);return 0===n?t.count-e.count:n}).filter(e=>e.address!==window.location.href&&e.count>0).slice(0,8)};